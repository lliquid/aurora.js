(function(a){matrix=function(){var a={version:"0.0",consts:{ZERO:1e-9},zeros:function(a,b){var c=[];for(var d=0;d<a;d++){var e=[];c.push(e);for(var f=0;f<b;f++)e.push(0)}return c},identity:function(a){var b=this.zeros(a,a);for(var c=0;c<a;c++)b[c][c]=1;return b},trace:function(a){var b=[];for(var c=0,d=a.length;c<d;c++)b.push(a[c][c]);return b},col:function(a,b){var c=[];for(var d=0,e=b.length;d<e;d++)c.push(b[d][a]);return c},eigen:function(a){var b=science.lin.decompose(),c=b.call(null,a),d=this.trace(c.D);o=algo.order(d);var e=[];for(var f=0,g=o.length;f<g;f++)e.push(this.col(o[f],c.V));algo.sort(d);var f=0;for(g=d.length;f<g;f++)if(Math.abs(d[f])>this.consts.ZERO)break;return{E:d,V:e,IDX:f}},find_maximum_rectangle:function(b){var c=a.get_num_rows(b),d=a.get_num_cols(b),e=a.zeros(c,d),f=0,g=0,h=0,i=0;if(c==0||d==0)return null;for(var j=0;j<c;j++){var k=0;for(var l=d-1;l>=0;l--)b[j][l]>0?k++:k=0,e[j][l]=k}var n=[],o=0;for(var l=0;l<d;l++){var j=0;while(j<c)if(n.length==0||e[n[n.length-1]][l]<=e[j][l])n.push(j++);else{var p=n[n.length-1];n.pop(),n.length==0?j*e[p][l]>o&&(o=j*e[p][l],f=p,g=l,i=e[p][l],h=j):(j-n[n.length-1]-1)*e[p][l]>o&&(o=(j-n[n.length-1]-1)*e[p][l],f=n[n.length-1]+1,g=l,i=e[p][l],h=j-n[n.length-1]-1)}while(n.length>0){var p=n[n.length-1];n.pop(),n.length==0?j*e[p][l]>o&&(o=j*e[p][l],f=p,g=l,i=e[p][l],h=j):(j-n[n.length-1]-1)*e[p][l]>o&&(o=(j-n[n.length-1]-1)*e[p][l],f=n[n.length-1]+1,g=l,i=e[p][l],h=j-n[n.length-1]-1)}}return{i0:f,j0:g,height:h,width:i}},clean_rectangle:function(a,b,c,d,e){for(var f=a,g=c+a;f<g;f++)for(var h=b,i=d+b;h<i;h++)e[f][h]=0;return e},is_zero:function(b){var c=!0;for(var d=0,e=a.get_num_rows(b);d<e;d++)for(var f=0,g=a.get_num_cols(b);f<g;f++)b[d][f]!=0&&(c=!1);return c},find_nearest_empty_entry:function(b,c,d){if(b<0||b>=a.get_num_rows(d)||c<0||c>=a.get_num_cols(d)){var e=b,f=c;return b<0&&(e=0),b>=a.get_num_rows(d)&&(e=a.get_num_rows(d)-1),c<0&&(f=0),c>=a.get_num_cols(d)&&(f=a.get_num_cols(d)-1),{i:e,j:f}}var e=b,f=c,g=0;while(d[e][f]!=0){e==b-g&&f==c-g?(e-=1,g+=1):e==b-g&&f<c+g?f+=1:f==c+g&&e<b+g?e+=1:e==b+g&&f>c-g?f-=1:f==c-g&&e>b-g&&(e-=1);if(e<0||e>=a.get_num_rows(d)||f<0||f>=a.get_num_cols(d))return e<0&&(e=0),e>=a.get_num_rows(d)&&(e=a.get_num_rows(d)-1),f<0&&(f=0),f>=a.get_num_cols(d)&&(f=a.get_num_cols(d)-1),{i:e,j:f}}return{i:e,j:f}},get_num_rows:function(a){return a.length},get_num_cols:function(a){return a.length==0?0:a[0].length},to_string:function(b){var c="",d=a.get_num_rows(b),e=a.get_num_cols(b)},test_spiral:function(){var b=matrix.zeros(7,7);for(var c=0,d=36;c<d;c++){var e=a.find_nearest_empty_entry(3,3,b);b[e.i][e.j]=1,console.info(e)}},test_max_rectangle:function(){var b=matrix.zeros(8,8);for(var c=0,d=30;c<d;c++){var e=a.find_nearest_empty_entry(3,3,b);b[e.i][e.j]=1}console.info(b),a.find_maximum_rectangle(b)}};return a}(),Graph=function(){var a=this;this.empty=function(){return this.nodes=[],this.links=[],this.adjlinks=[],this.nodeIdx={},this.linkIdx={},this.invalidNodeIndices=[],this.nextNodeIdx=0,this.invalidEdgeIndices=[],this.nextEdgeIdx=0,this},this.empty()},_.extend(Graph.prototype,{addNode:function(a,b){if(this.node(a)!=null){console.info("node "+a+"already in");return}var c={id:a+"",name:"",attrs:{}},d=-1;return this.invalidNodeIndices.length==0?(this.nodes.push(undefined),this.adjlinks.push(undefined),d=this.nextNodeIdx,this.nextNodeIdx++):d=this.invalidNodeIndices.pop(),this.nodes[d]=c,this.adjlinks[d]=[],this.nodeIdx[a]=d,this.updateNodeAttrs(b,a),this},addLink:function(a,b,c,d){if(this.link(a)!=null){console.info("link "+a+"already in");return}var e={id:a+"",source:b+"",target:c+"",attrs:{}};this.node(b)==undefined&&this.addNode(b),this.node(c)==undefined&&this.addNode(c);var f=-1;this.invalidEdgeIndices.length==0?(this.links.push(null),f=this.nextEdgeIdx,this.nextEdgeIdx++):f=this.invalidEdgeIndices.pop();var g=this.nodeIdx[b],h=this.nodeIdx[c];return this.links[f]=e,this.linkIdx[a]=f,this.adjlinks[g].push(a),this.adjlinks[h].push(a),this.updateLinkAttrs(d,a),this},removeNode:function(a){if(!this.hasNode(a)){console.info("node "+a+" not exist");return}var b=this.adjacents(a).slice(0);for(var c=0;c<b.length;c++)this.removeLink(b[c]);var d=this.nodeIdx[a];return this.invalidNodeIndices.push(d),this.nodes[d]=undefined,this.nodeIdx[a]=undefined,this.adjlinks[d]=undefined,this},removeLink:function(a,b){var c=undefined,d=-1,e=undefined,f=undefined,g=undefined;arguments.length==1?(c=this.link(a),d=this.linkIdx[a]):arguments.length>=2&&(c=this.link(a,b),d=this.linkIdx[c.id]),e=c.source,f=c.target,this.invalidEdgeIndices.push(d),this.linkIdx[g]=undefined,this.links[d]=undefined;var h=this.adjlinks[this.nodeIdx[c.source]],i=this.adjlinks[this.nodeIdx[c.target]];return h.splice(h.indexOf(c.id),1),i.splice(i.indexOf(c.id),1),this},node:function(a){return this.nodeIdx[a]==undefined||this.nodes[this.nodeIdx[a]]==undefined?null:this.nodes[this.nodeIdx[a]]},hasNode:function(a){return this.node(a)!==null},link:function(a,b){if(arguments.length==1)return this.linkIdx[a]==undefined||this.links[this.linkIdx[a]]==undefined?null:this.links[this.linkIdx[a]];if(arguments.length==2){var c=this.adjacents(a),d=[];for(var e=0,f=c.length;e<f;e++)this.link(c[e])&&(this.link(c[e]).source==a&&this.link(c[e]).target==b||this.link(c[e]).source==b&&this.link(c[e]).target==a)&&d.indexOf(c[e])==-1&&d.push(c[e]);return d.length==1?d[0]:d.length==0?null:d}return undefined},hasLink:function(a,b){var c=this.link(a,b);return c!==null&&c!==undefined},neighbor:function(a,b){return a==this.link(b).source?this.link(b).target:this.link(b).source},adjacents:function(a){return this.adjlinks[this.nodeIdx[a]]},neighbors:function(a){var b=this.adjacents(a),c=[];for(var d=0,e=b.length;d<e;d++){var f=this.neighbor(a,b[d]);c.indexOf(f)==-1&&c.push(f)}return c},degree:function(a,b){if(arguments.length==1)return this.adjacents(a).length;var c=this.adjacents(a),d=0;for(var e=0,f=c.length;e<f;e++)d+=this.getLinkAttr("w",c[e]);return d},precedessors:function(a){},successors:function(a){},indegree:function(a){},outdegree:function(a){},getNodes:function(){var a=[],b=_.sortBy(this.invalidNodeIndices);for(var c=0,d=this.nodes.length,e=0;c<d;c++)e<b.length&&c<b[e]||e>=b.length?a.push(this.nodes[c].id):e++;return a},getLinks:function(){var a=[],b=_.sortBy(this.invalidEdgeIndices);for(var c=0,d=this.links.length,e=0;c<d;c++)e<b.length&&c<b[e]||e>=b.length?a.push(this.links[c].id):e++;return a},getNodeAttr:function(a,b){return this.node(b).attrs[a]},getNodeAttrs:function(a,b){var c={};for(var d=0,e=a.length;d<e;d++)c[a[d]]=this.getNodeAttr(a[d],b);return c},getLinkAttr:function(a,b){return this.link(b).attrs[a]},hasNodeAttr:function(a){var b=this.getNodes();if(b.length==0)return!1;for(var c=0;c<b.length;c++)if(this.getNodeAttr(a,b[c])!=undefined)return!0;return!1},getAttrVals:function(a){var b=this.getNodes(),c=-1,d=[];while(++c<b.length)d.push(this.getNodeAttr(a,b[c]));return d=_.uniq(d),d.indexOf(undefined)>-1&&d.splice(d.indexOf(undefined),1),d},bfs:function(a,b){var c=d3.set([a]),d=d3.map(),e=[a];d.set(a,0);while(e.length>0){var f=e.shift(),g=d.get(f);if(g>=b)continue;var h=this.neighbors(f);for(var i=0,j=h.length;i<j;i++)c.has(h[i])||(e.push(h[i]),c.add(h[i]),d.set(h[i],g+1))}return d},updateNodeAttrs:function(a,b){var c=this.node(b);a=a||{};for(var d in a)if(a.hasOwnProperty(d))switch(d){case"id":break;case"name":c.name=a[d];break;default:c.attrs[d]=a[d]}},updateLinkAttrs:function(a,b){var c=this.link(b);a=a||{};for(var d in a)if(a.hasOwnProperty(d))switch(d){case"id":break;case"source":break;case"target":break;default:c.attrs[d]=a[d]}},adjacencyMatrix:function(a,b){var c=matrix.zeros(a.length,a.length);for(var d=0,e=a.length;d<e;d++)for(var f=d+1,g=a.length;f<g;f++){var h=this.link(a[d],a[f]);if(_.isArray(h))if(b==undefined||b==0)c[f][d]=c[d][f]=h.length;else{var i=0;for(var j=0;j<h.length;j++)i+=this.getLinkAttr("weight",h[j]);c[f][d]=c[d][f]=i}else h!=null&&(b==undefined||b==0?c[f][d]=c[d][f]=1:c[f][d]=c[d][f]=this.getLinkAttr("weight",h))}return c},attributes:function(a){var b=this,c=b.getNodes().filter(function(c){return b.getNodeAttr("bipartite",c)==a||b.getNodeAttr("bipartite",c)==a.toString()});if(c.length==0)return[];var d=0,e=_.keys(b.node(c[d]).attrs);while(++d<c.length)e=_.intersection(e,_.keys(b.node(c[d]).attrs));return e},info:function(){return"#nodes = "+this.nodes.length+"; "+"#links = "+this.links.length}}),_.extend(Graph.prototype,{loadJSON:function(a){for(var b=0,c=a.nodes.length;b<c;b++)this.addNode(a.nodes[b].id,a.nodes[b]);for(var b=0,c=a.links.length;b<c;b++)this.addLink(b,a.nodes[a.links[b].source].id,a.nodes[a.links[b].target].id)}}),_.extend(Graph.prototype,{project:function(a,b){var c=new Graph,d={};for(var e=0;e<a.length;e++)c.addNode(a[e]),d[a[e]]=this.neighbors(a[e]);for(var e=0;e<a.length;e++)for(var f=0;f<a.length;f++){var g=_.intersection(d[a[e]],d[a[f]]).length;g>0&&c.addLink(e*a.length+f,a[e],a[f],{weight:g})}return c}}),_.extend(Graph.prototype,{test:function(){g_test=new Graph,g_test.addNode("a"),g_test.addNode("b"),g_test.addNode("c"),g_test.addNode("d"),g_test.addNode("e"),g_test.addLink("ab","a","b"),g_test.addLink("ac","a","c"),g_test.addLink("ad","a","d"),g_test.addLink("de","d","e"),g_test.addLink("cb","c","b"),g_test.addLink("cc","c","c")}}),_.extend(Graph.prototype,{laplacianMatrix:function(a,b){var c=this.adjacencyMatrix(a,b),d=[];for(var e=0,f=a.length;e<f;e++){var g=0;for(var h=0,i=a.length;h<i;h++)g+=c[e][h];d.push(g)}for(var e=0,f=a.length;e<f;e++)c[e][e]=d[e];for(var e=0,f=a.length;e<f;e++)for(var h=e,i=a.length;h<i;h++)c[e][h]=-c[e][h],c[h][e]=-c[h][e];return c},fiedlerVector:function(a){var b=this.getNodes(),c=this.laplacianMatrix(b,a),d=matrix.eigen(c),e={};for(var f=0;f<b.length;f++)e[b[f]]=d.V[d.IDX][f];return e}}),_.extend(Graph.prototype,{bundles:function(a){var b=this.adjacencyMatrix(a),c=[];for(var d=0,e=a.length;d<e;d++)b[d][d]=1;while(!matrix.is_zero(b)){var f=matrix.find_maximum_rectangle(b);if(f==null||f.height==0&&f.width==0||f.height==1&&f.width==1)break;f.height==1&&f.width>1&&(f.i0==f.j0?(f.j0+=1,f.width-=1):f.i0==f.j0+f.width-1&&(f.width-=1)),f.width==1&&f.height>1&&(f.i0==f.j0?(f.i0+=1,f.height-=1):f.j0==f.i0+f.height-1&&(f.height-=1)),f.height>f.width?c.push({i0:f.j0,i1:f.j0+f.width-1,j0:f.i0,j1:f.i0+f.height-1}):c.push({i0:f.i0,i1:f.i0+f.height-1,j0:f.j0,j1:f.j0+f.width-1}),matrix.clean_rectangle(f.i0,f.j0,f.height,f.width,b),matrix.clean_rectangle(f.j0,f.i0,f.width,f.height,b)}for(var d=0,e=a.length;d<e;d++)for(var g=d,h=a.length;g<h;g++)b[d][g]!=0&&d!=g&&c.push({i0:d,i1:d,j0:g,j1:g});return c}})})(this);